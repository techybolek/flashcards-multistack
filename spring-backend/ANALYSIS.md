# Spring Boot Application Analysis: 10x Cards Backend

This document provides an analysis of the 10x Cards Backend Spring Boot application.

## 1. Project Overview

The application is the backend for a flashcard service called "10x Cards". It allows users to register, log in, manage their flashcards, and automatically generate new flashcards from text using the OpenAI API.

- **Group ID:** `com.tenxcards`
- **Artifact ID:** `flashcards-backend`
- **Spring Boot Version:** 3.2.0
- **Java Version:** 17

## 2. Core Technologies & Dependencies

- **Web Framework:** Spring Boot Web
- **Data Persistence:** Spring Data JPA with Hibernate
- **Security:** Spring Security with JSON Web Tokens (JWT)
- **Databases:**
    - H2 (for development)
    - PostgreSQL (for production)
- **AI Integration:** `com.theokanning.openai-gpt3-java` for interacting with the OpenAI API.
- **Validation:** Spring Boot Starter Validation for request data validation.

## 3. Architecture

The application follows a standard layered architecture:

- **`controller`**: Exposes RESTful API endpoints.
- **`service`**: Contains the core business logic.
- **`repository`**: Manages data access using Spring Data JPA.
- **`entity`**: Defines the database entities (data model).
- **`dto`**: Data Transfer Objects used for API requests and responses.
- **`security`**: Handles JWT-based authentication and user details.
- **`config`**: Contains application configuration, such as `SecurityConfig`.

## 4. Configuration (`application.yml`)

The application uses a profile-based configuration system.

### Default (Development) Profile:
- **Server Port:** `3001`
- **Database:** In-memory H2 database.
- **JPA:** `ddl-auto` is set to `create-drop`, automatically creating the schema on startup.
- **H2 Console:** Enabled at `/h2-console`.
- **CORS:** Allows requests from `localhost:5173` and `localhost:3000`.
- **Logging:** `DEBUG` level for detailed logs.

### `prod` (Production) Profile:
- **Database:** PostgreSQL.
- **JPA:** `ddl-auto` is set to `validate` for safety.
- **H2 Console:** Disabled.
- **Logging:** `INFO` level.

### Environment Variables:
The application expects the following environment variables, especially in production:
- `JWT_SECRET`: The secret key for signing JWTs.
- `OPENAI_API_KEY`: The API key for the OpenAI service.
- `DB_USERNAME`: The database username.
- `DB_PASSWORD`: The database password.

## 5. API Endpoints

### Authentication (`/api/auth`)
- `POST /login`: Authenticates a user and returns a JWT.
- `POST /register`: Creates a new user account.
- `POST /logout`: Logs the user out.
- `POST /recover`: (Placeholder) Handles password recovery requests.

### Flashcards (`/api/flashcards`)
- `POST /`: Creates a new flashcard for the authenticated user.
- `PUT /{id}`: Updates an existing flashcard.
- `DELETE /{id}`: Deletes a flashcard.

### AI Generations (`/api/generations`)
- `POST /`: Generates a set of flashcard proposals from a given text using the OpenAI service.
- `GET /`: Retrieves a list of all past generations for the user.
- `GET /{id}`: Retrieves the details of a single generation and its associated flashcards.
- `PUT /{id}`: Updates the flashcards within a generation.
- `DELETE /{id}`: Deletes a generation and all its associated flashcards.

## 6. Key Functionality

### User Management
- The `UserService` and `AuthController` handle user registration and authentication.
- Spring Security is used to protect endpoints, and the `UserService` implements `UserDetailsService` to load user data.

### JWT Authentication
- The `JwtTokenProvider` class is responsible for generating and validating JWTs.
- A `JwtAuthenticationFilter` intercepts requests to process the JWT and set the user authentication in the security context.

### AI-Powered Flashcard Generation
- The `GenerationController` orchestrates the AI generation process.
- The `OpenAIService` builds a prompt, sends a request to the OpenAI API (`gpt-3.5-turbo` model), and parses the response into flashcard proposals.
- The service includes a fallback mechanism to provide mock data if the API call fails, which is useful for testing.

### Data Model (Entities)
- **`User`**: Represents a user of the application.
- **`Flashcard`**: Represents a single flashcard with a front and back.
- **`Generation`**: Represents a batch of flashcards generated by the AI.
- **`FlashcardSource`**: An enum indicating the source of a flashcard (e.g., `USER_CREATED`, `AI_GENERATED`).
